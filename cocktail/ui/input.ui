<?xml version="1.0" encoding="utf-8"?>

<div
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://www.whads.com/ns/cocktail/ui" tabindex="0">

    <ui:requires component="cocktail.ui.delay"/>
    <ui:using mixin="cocktail.ui.DataDisplay"/>

    <?tail
    cls.delegatesFocus = true;
    ?>

    <?class
    updateValue() {
        this.setAttribute("value", this.input.value);
    }
    ?>

    <?on value:changed
    if (this.dataBinding) {
        this.input.value = this.dataBinding.member.serializeValue(newValue);
    }
    ?>

    <?js
    this.updateDelay = new cocktail.ui.Delay(300, () => this.updateValue());
    ?>

    <input id="input">

        <?on keydown
        if (e.which == cocktail.ui.keys.ENTER) {
            instance.updateValue();
        }
        else if (!cocktail.ui.nonTextKeys.has(e.which)) {
            instance.updateDelay.begin();
        }
        ?>

        <?on change
        instance.updateValue();
        ?>

    </input>

</div>

